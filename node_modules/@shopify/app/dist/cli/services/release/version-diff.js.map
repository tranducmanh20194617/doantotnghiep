{"version":3,"file":"version-diff.js","sourceRoot":"","sources":["../../../../src/cli/services/release/version-diff.ts"],"names":[],"mappings":"AAGA,OAAO,EAAC,WAAW,EAAC,MAAM,0BAA0B,CAAA;AACpD,OAAO,EAAC,gBAAgB,EAAC,MAAM,6BAA6B,CAAA;AAE5D,MAAM,CAAC,KAAK,UAAU,oBAAoB,CACxC,MAAc,EACd,OAAe,EACf,uBAAgD;IAKhD,MAAM,cAAc,GAAG,MAAM,mBAAmB,CAAC,MAAM,EAAE,OAAO,EAAE,uBAAuB,CAAC,CAAA;IAC1F,MAAM,KAAK,GAA6B;QACtC,MAAM;QACN,SAAS,EAAE,cAAc,CAAC,EAAE;KAC7B,CAAA;IACD,MAAM,EACJ,GAAG,EAAE,EAAC,YAAY,EAAC,GACpB,GAA0B,MAAM,uBAAuB,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;IAE/E,OAAO,EAAC,YAAY,EAAE,cAAc,EAAC,CAAA;AACvC,CAAC;AAED,KAAK,UAAU,mBAAmB,CAAC,MAAc,EAAE,OAAe,EAAE,uBAAgD;IAClH,IAAI;QACF,MAAM,KAAK,GAA6B;YACtC,MAAM;YACN,UAAU,EAAE,OAAO;SACpB,CAAA;QACD,MAAM,EACJ,GAAG,EAAE,EAAC,UAAU,EAAC,GAClB,GAA0B,MAAM,uBAAuB,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;QAC/E,OAAO,UAAU,CAAA;KAClB;IAAC,OAAO,GAAG,EAAE;QACZ,WAAW,CAAC;YACV,QAAQ,EAAE,+BAA+B;YACzC,IAAI,EAAE,CAAC,SAAS,EAAE,EAAC,SAAS,EAAE,OAAO,EAAC,EAAE,qBAAqB,CAAC;SAC/D,CAAC,CAAA;QACF,MAAM,IAAI,gBAAgB,EAAE,CAAA;KAC7B;AACH,CAAC","sourcesContent":["import {AppVersionsDiffSchema, AppVersionsDiffVariables} from '../../api/graphql/app_versions_diff.js'\nimport {AppVersionByTagSchema, AppVersionByTagVariables} from '../../api/graphql/app_version_by_tag.js'\nimport {DeveloperPlatformClient} from '../../utilities/developer-platform-client.js'\nimport {renderError} from '@shopify/cli-kit/node/ui'\nimport {AbortSilentError} from '@shopify/cli-kit/node/error'\n\nexport async function versionDiffByVersion(\n  apiKey: string,\n  version: string,\n  developerPlatformClient: DeveloperPlatformClient,\n): Promise<{\n  versionsDiff: AppVersionsDiffSchema['app']['versionsDiff']\n  versionDetails: AppVersionByTagSchema['app']['appVersion']\n}> {\n  const versionDetails = await versionDetailsByTag(apiKey, version, developerPlatformClient)\n  const input: AppVersionsDiffVariables = {\n    apiKey,\n    versionId: versionDetails.id,\n  }\n  const {\n    app: {versionsDiff},\n  }: AppVersionsDiffSchema = await developerPlatformClient.appVersionsDiff(input)\n\n  return {versionsDiff, versionDetails}\n}\n\nasync function versionDetailsByTag(apiKey: string, version: string, developerPlatformClient: DeveloperPlatformClient) {\n  try {\n    const input: AppVersionByTagVariables = {\n      apiKey,\n      versionTag: version,\n    }\n    const {\n      app: {appVersion},\n    }: AppVersionByTagSchema = await developerPlatformClient.appVersionByTag(input)\n    return appVersion\n  } catch (err) {\n    renderError({\n      headline: \"Version couldn't be released.\",\n      body: ['Version', {userInput: version}, 'could not be found.'],\n    })\n    throw new AbortSilentError()\n  }\n}\n"]}